<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>meure ebook</title>

    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/ebook.css"> 
    <script src="./js/ebook.js"></script>
    

  </head>
  <body>
    <div class="ebook__wrapper">
      <div class="ebook__top-box">
        <h2>
          <img src="./img/logo.svg" alt="" class="logo">
        </h2>
        <div class="ebook__top-box-right">
          <ul class="ebook__top-box-btn-list">
            <li>
              <button type="button" class="ic_print" onclick="onPrint('.ebook__img-list')">
                <img src="./img/ic_print.svg" alt="">
                <span>출력</span>
              </button>
            </li>
            <li>
              <a href="./img/상품카달로그(22.05.11)_펼침면.pdf" download class="ic_download">
                <img src="./img/ic_download.svg" alt="">
                <span>다운로드</span>
              </a>
            </li>
            <li>
              <button type="button" class="ic_share" onclick="onShareListModal()">
                <img src="./img/ic_share.svg" alt="">
                <span>공유</span>
              </button>
            </li>
          </ul>
          <button type="button" class="ebook__top_view_total">
            <img src="./img/ic_all_zoom.svg" alt="">
            <span>전체화면</span>
          </button>
        </div>        
      </div>      
      <div class="ebook__mini_map">
        <div class="ebook__mini_map_img_box"></div>
      </div>
      <div onmousedown="dragBoxEvent(event)" class="ebook__mini_map_drag_box"></div>
      <div class="ebook_scroll_box">
        <div class="ebook__scroll">
          <div class="ebook__container" onmousemove="move();" onmouseup="leave()" onmousedown="set_value();">     
            <!-- <div class="cover" style="position:absolute;width:100%;height:100%;left:0;top:0;z-index:10"></div>      -->
            <ul class="ebook__img-list">
              <li>
                <img src="./img/ebook/ebook_1.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_2.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_3.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_4.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_5.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_6.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_7.jpg" alt="">
              </li>
              <li>
                <img src="./img/ebook/ebook_8.jpg" alt="">
              </li>
            </ul>
          </div>
        </div>
        <div class="ebook__right-floating">
          <button type="button" class="ebook__bottom_control_page basic">
            <img src="./img/zoom_out.svg">
            <span>기본화면</span>
          </button>
          <div class="ebook__scale">
            <button type="button" class="ebook__scale-zoom-in"><span class="wid"></span><span class="height"></span></button>
            <input type="range" class="ebook__scale-zoom-range" min="1" max="3" onchange="onZoomRange(this)">
            <div class="ebook__scale-txt">
              <span>Max</span>
              <span>100%</span>
              <span>Min</span>
            </div>
            <button type="button" class="ebook__scale-zoom-out"><span class="wid"></span></button>
          </div>
          <div class="ebook__page-move-control">
            <button type="button" class="ebook__page-move-btn prev"></button>
            <div class="ebook__page-txt">
              <span class="cur"></span>/
              <span class="total"></span>
            </div>
            <ul class="ebook__page-move-list"></ul>
            <button type="button" class="ebook__page-move-btn next"></button>
          </div>
          <div class="ebook__page_control">
            <button type="button" class="ebook__bottom_control_page_list" onclick="onPageListModal()">
              <img src="./img/ic_list.png" alt="">
            </button>            
            <button type="button" class="ebook__bottom_control_page page_1">한장</button>
            <button type="button" class="ebook__bottom_control_page page_2">두장</button>
          </div>
        </div>
        <div class="ebook__control">
          <button type="button" class="ebook__prev on"><span>이전</span></button>
          <button type="button" class="ebook__next on"><span>다음</span></button>
        </div>
      </div>      
      <div class="ebook__bottom-box">
        <span class="ebook__bottom-copyright">
          copyright. MEURE all right reserved.
        </span>
        <ul class="ebook__bottom-link">
          <li><a href="#" class="ic_home">
            <img src="./img/ic_home.svg" alt="">
          </a></li>
          <li><a href="#" class="ic_insta">
            <img src="./img/ic_insta.svg" alt="">
          </a></li>
          <li><a href="#" class="ic_kakao">
            <img src="./img/ic_kakao.svg" alt="">
          </a></li>
        </ul>
      </div>
      <!-- 페이지목록 팝업 -->
      <div class="com_pop_wrap ebook__page_modal_wrapper">
        <div class="ebook__page_modal">
          <div class="top">
            <span><img src="./img/ic_list_sm.png" alt="">목차</span>
            <button type="button" onclick="closePageListModal()" class="btn_close">
            </button>
          </div>
          <ul class="ebook__page_modal_list">
            <li>
              <img src="./img/ebook/ebook_1.jpg" alt="">
              <span>1. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_2.jpg" alt="">
              <span>2. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_3.jpg" alt="">
              <span>3. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_4.jpg" alt="">
              <span>4. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_5.jpg" alt="">
              <span>5. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_6.jpg" alt="">
              <span>6. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_7.jpg" alt="">
              <span>7. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_8.jpg" alt="">
              <span>8. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_1.jpg" alt="">
              <span>1. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_2.jpg" alt="">
              <span>2. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_3.jpg" alt="">
              <span>3. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_4.jpg" alt="">
              <span>4. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_5.jpg" alt="">
              <span>5. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_6.jpg" alt="">
              <span>6. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_7.jpg" alt="">
              <span>7. 표지</span>
            </li>
            <li>
              <img src="./img/ebook/ebook_8.jpg" alt="">
              <span>8. 표지</span>
            </li>
          </ul>
        </div>
        <div class="bg" onclick="closePageListModal()"></div>
      </div>
      <!-- //페이지목록 팝업 -->
      <!-- 공유 팝업 -->
      <div class="com_pop_wrap ebook__share_wrap">
        <div class="ebook__share_con">
          <div class="top">
            <span>
              <img src="./img/ic_share_top.svg" alt="">
              공유
            </span>
            <button onclick="closeShareListModal()" type="button" class="ebook__top_control_close"></button>
          </div>
          <div class="con_box">
            <ul class="share_list">
              <li>
                <button type="button" onclick="KaKaosendLink('미에르 공식쇼핑몰-meure','https://meure.co.kr/index/_upload/goods/beauty/04_becina_oil_mist/p_04_becina_oil_mist_135ml_shot.jpg','https://meure.co.kr/index/shop.php?cat=00010002&r=view&uid=15&sponsor=','비치나 오일 미스트-BECINA OIL MIST')">
                  <img src="./img/ic_share_kakao.png" alt="">
                </button>
              </li>
              <li>
                <button type="button" onclick="onShare('blog')">
                  <img src="./img/ic_share_blog.png" alt="">
                </button>
              </li>
              <!-- <li>
                <button type="button">
                  <img src="./img/ic_share_insta.png" alt="">
                </button>
              </li> -->
              <li>
                <button type="button" onclick="onShare('face')">
                  <img src="./img/ic_share_face.png" alt="">
                </button>
              </li>
              <li>
                <button type="button" onclick="onShare('twt')">
                  <img src="./img/ic_share_twt.png" alt="">
                </button>
              </li>
            </ul>
            <div class="copy_url">
              <input type="text" readonly value="http://127.0.0.1:5500/ebook.html">
              <button onclick="textCopy('.copy_url input')" type="button" class="btn_copy">주소 복사</button>
            </div>
          </div>
        </div>
        <div onclick="closeShareListModal()" class="bg"></div>
      </div>
      <!-- //공유 팝업 -->
    </div>
  </body>
</html>
<script type="text/javascript" src="//developers.kakao.com/sdk/js/kakao.min.js"></script>

<script>
const ebook = new Ebook('.ebook__wrapper',{
  prev:'.ebook__prev',
  next:'.ebook__next',
  currentPage:'.ebook__page-current',
  breakPoints:{
    768:{
      pageShow:1
    }
  }
})
ebook.init();



function onPrint() {
  let hiddenHeader = document.querySelector('.ebook__top-box');
  let hiddenSide = document.querySelector('.ebook__right-floating');
  let hiddenBottom = document.querySelector('.ebook__bottom-box');
  let hiddenBtn = document.querySelector('.ebook__control');
 
  window.onbeforeprint = function () {
    hiddenHeader.style.display = "none";
    hiddenSide.style.display = "none";
    hiddenBottom.style.display = "none";
    hiddenBtn.style.display = "none";
  }
  window.onafterprint = function () {
    hiddenHeader.style.display = "flex";
    hiddenSide.style.display = "flex";
    hiddenBottom.style.display = "flex";
    hiddenBtn.style.display = "block";
  }
  window.print();
}


const toPage = (num) => {
  ebook.page = num;
  ebook.pageSet();
}
const pageListToggle = () => {
  ebook.pageListToggleOn()
}


let pre_x = 0, pre_y = 0, dragging = false;
let moveCheck = false;
function set_value()
{
  moveCheck = false;
  dragging = true;
  pre_x = event.x;
  pre_y = event.y;
}

function leave() {
  dragging = false;
}

let scrollBox = document.querySelector('.ebook_scroll_box')
function move()
{ 
  if(dragging){
    document.querySelector('.ebook_scroll_box.zoom-mode .ebook__scroll')?.classList.add('move')
  }else{
    document.querySelector('.ebook_scroll_box.zoom-mode .ebook__scroll')?.classList.remove('move');
    return
  }
  let delta_x = pre_x - event.x;
  let delta_y = pre_y - event.y;
  pre_x = event.x;
  pre_y = event.y;
  moveCheck = true;
  if(event.x <= 80 || event.x >= window.innerWidth - 80 || event.y <= 80 || event.y >= window.innerHeight - 80){
    leave()
  }else{
    scrollBox.scrollBy(delta_x,delta_y);
  }

  let perX = ebook.scrollBox.scrollLeft/ebook.scrollBox.scrollWidth
  let perY = ebook.scrollBox.scrollTop/ebook.scrollBox.scrollHeight
  ebook.dragBox.style.left = ebook.miniMap.offsetLeft + ebook.miniMap.clientWidth*perX + 'px';
  ebook.dragBox.style.top = ebook.miniMap.offsetTop + ebook.miniMap.clientHeight*perY + 'px';
}

function onZoomRange(e){
  let step = e.value;
  switch(step){
    case '3':
      ebook.imgZoomMax();
      break;
    case '1':
      ebook.imgZoomMin();
      break;
    default :
      ebook.imgZoomDefault();
      break;
  }
}

const shareListModal = document.querySelector('.ebook__share_wrap');
function onShareListModal(){
  shareListModal.classList.add('on');
}
function closeShareListModal(){
  shareListModal.classList.remove('on');
}

function textCopy(div){
  let box = document.querySelector(div);
  box.select();
  document.execCommand('copy');
  alert('주소가 복사되었습니다.')
}

const pageListModal = document.querySelector('.ebook__page_modal_wrapper')
function onPageListModal(){
  pageListModal.classList.add('on');
  const list = pageListModal.querySelectorAll('li');
  list.forEach((el,idx)=>{
    el.addEventListener('click',function(){
      toPage(idx+1);
      ebook.pageSet();
      closePageListModal();
    })
  })
}


function closePageListModal(){
  const list = pageListModal.querySelectorAll('li');
  pageListModal.classList.remove('on');
}


//공유
function onShare(type) {
  let urlTxt = 'https://meure.co.kr'
  let url = encodeURI(encodeURIComponent(urlTxt));
  let url2 = encodeURIComponent(urlTxt);
  let twtText = '미에르 e-book'
  const title = encodeURI(document.title);
  let shareURL;
  if(type === 'blog'){
    shareURL = "https://share.naver.com/web/shareView?url=" + url + "&title=" + title;
  }
  if(type === 'face'){
    shareURL = "https://www.facebook.com/sharer/sharer.php?u="+url2
  }
  if(type === 'twt'){
    shareURL = "https://twitter.com/intent/tweet?text=" + twtText + "&url=" + urlTxt
  }
  window.open(shareURL)
}
Kakao.init('f225842d8152b618857ba7b3a9b37ffa');
//<![CDATA[
// // 사용할 앱의 JavaScript 키를 설정해 주세요.
// // 카카오링크 버튼을 생성합니다. 처음 한번만 호출하면 됩니다.
function KaKaosendLink(snstitle,snsimg,snsurl,snstxt) {
Kakao.Link.sendDefault({
	objectType: 'feed',
	content: {
	title: snstitle,
	description: snstxt,
	imageUrl: snsimg,
	link: {
		mobileWebUrl: snsurl,
		webUrl: snsurl
	}
	},

	buttons: [
	{
		title: '웹으로 보기',
		link: {
		mobileWebUrl: snsurl,
		webUrl: snsurl
		}
	}
	]
});
}
//]]>


let dragBox = document.querySelector('.ebook__mini_map_drag_box');


let miniPre_x = 0, miniPre_y = 0, miniDragging = false;
let minuMoveCheck = false;
function miniSet_value()
{
  minuMoveCheck = false;
  miniDragging = true;
  miniPre_x = event.x;
  miniPre_y = event.y;
}

function miniLeave() {
  miniDragging = false;
}

function miniMove()
{ 
  let delta_x = event.x - miniPre_x;
  let delta_y = event.y - miniPre_y;
  miniPre_x = event.x;
  miniPre_y = event.y;
  minuMoveCheck = true;
  scrollBox.scrollBy(delta_x*20,delta_y*20);
}
function dragBoxEvent(event) {
  let miniMap = document.querySelector('.ebook__mini_map');
  let minLeft = miniMap.offsetLeft;
  let minTop = miniMap.offsetTop;
  let maxLeft = miniMap.offsetLeft + miniMap.clientWidth;
  let maxTop = miniMap.offsetTop + miniMap.clientHeight;
  let shiftX = event.clientX - dragBox.getBoundingClientRect().left;
  let shiftY = event.clientY - dragBox.getBoundingClientRect().top;
  miniSet_value();
  moveAt(event.pageX, event.pageY);

  function moveAt(pageX, pageY) {
    if(pageX - shiftX < minLeft){
      dragBox.style.left = minLeft + 'px'
    }else if(pageX - shiftX > maxLeft-dragBox.clientWidth){
      dragBox.style.left = maxLeft-dragBox.clientWidth + 'px'
    }else{
      dragBox.style.left = pageX - shiftX + 'px';
    }
    if(pageY - shiftY < minTop){
      dragBox.style.top = minTop + 'px'
    }else if(pageY - shiftY > maxTop-dragBox.clientHeight){
      dragBox.style.top = maxTop-dragBox.clientHeight + 'px'
    }else{
      dragBox.style.top = pageY - shiftY + 'px';
    }
  }

  function onMouseMove(event) {
    let moveX = event.pageX;
    let moveY = event.pageY;    
    moveAt(moveX, moveY);
    miniMove();
  }

  document.addEventListener('mousemove', onMouseMove);

  dragBox.onmouseup = function() {
    miniLeave();
    document.removeEventListener('mousemove', onMouseMove);
    dragBox.onmouseup = null;
  };

  window.onmouseup = function(e) {
    let x = e.x;
    let y = e.y;
    if(x < minLeft || x > maxLeft || y < minTop || y > maxTop){
      miniLeave();
      document.removeEventListener('mousemove', onMouseMove);
      dragBox.onmouseup = null;
    }
  }

};

dragBox.ondragstart = function() {
  return false;
};

let resizeTimer;
window.addEventListener('resize',()=>{
  clearTimeout(resizeTimer)
  resizeTimer = setTimeout(()=>{
    ebook.btnSet()
  },50)  
})
  

</script>
